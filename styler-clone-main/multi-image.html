<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Advanced Leva-Style Controller</title>
    <style>
      :root {
        --bg: #202225;
        --panel-bg: #2f3136;
        --text: #e0e0e0;
        --accent: #00b0f4;
        --border: #40444b;
      }
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      #controller {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 280px;
        background: var(--panel-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        padding: 12px 16px;
        user-select: none;
        cursor: grab;
        font-family: monospace;
        transition: box-shadow 0.2s ease;
        transform: translate(0, 0);
      }
      #controller.dragging {
        cursor: grabbing;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
      }
      #controller h2 {
        margin: 0 0 14px;
        font-size: 18px;
        text-align: center;
        color: var(--accent);
      }
      .header {
        display: flex;
        justify-content: space-between;
      }
      .control {
        margin-bottom: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
      }
      .control label {
        display: block;
        flex-basis: 80px;
        font-size: 12px;
        margin-bottom: 4px;
      }
      .control input {
        width: fit-content;
      }
      .control input[type="range"] {
        width: 100%;
        accent-color: var(--accent);
      }
      .control input[type="color"],
      .control select {
        width: 100%;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: #3a3c43;
        color: var(--text);
        padding: 4px;
      }
      .control input[type="checkbox"] {
        transform: scale(1.3);
        margin-right: 6px;
      }
      .value-display {
        font-size: 12px;
        color: #999;
        margin-top: 3px;
        text-align: right;
      }

      #output {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="controller">
      <div class="header">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class=""
        >
          <circle cx="12" cy="5" r="1" />
          <circle cx="19" cy="5" r="1" />
          <circle cx="5" cy="5" r="1" />
          <circle cx="12" cy="12" r="1" />
          <circle cx="19" cy="12" r="1" />
          <circle cx="5" cy="12" r="1" />
          <circle cx="12" cy="19" r="1" />
          <circle cx="19" cy="19" r="1" />
          <circle cx="5" cy="19" r="1" />
        </svg>
        <h2>Controls</h2>
        <div class=""></div>
      </div>
    </div>

    <div id="output"></div>

    <script>
      const controller = document.getElementById("controller");
      const output = document.getElementById("output");
      let prevState = {};
      let state = {};

      const controls = {
        // enable: { type: "boolean", label: "Enable Feature", value: true },
        height: {
          type: "number",
          label: "Height",
          value: 100,
          min: 40,
          max: 500,
          step: 5,
        },
        width: {
          type: "number",
          label: "Width",
          value: 100,
          min: 40,
          max: 500,
          step: 5,
        },
        color: { type: "color", label: "Background", value: "#00b0f4" },
        images: { type: "file", label: "Images", value: null },
        // mode: { type: "select", label: "Mode", value: "auto", options: ["auto", "manual", "off"] }
      };

      function updateStateDisplay() {
        const { color, width, height } = state;
        requestAnimationFrame(() => {
          document.body.style.backgroundColor = color;
        });
        prevState = { ...state };
      }

         function updateValueEvent(key) {
        return (e)=>{

        }
      }
      
      function createControl(key, cfg) {
        const wrap = document.createElement("div");
        wrap.className = "control";
        const label = document.createElement("label");
        label.textContent = cfg.label;
        wrap.appendChild(label);
        let input;

        if (cfg.type === "number") {
          input = document.createElement("input");
          input.type = "range";
          input.min = cfg.min;
          input.max = cfg.max;
          input.step = cfg.step;
          input.value = cfg.value;
          const valDisp = document.createElement("div");
          valDisp.className = "value-display";
          valDisp.textContent = cfg.value;
          input.addEventListener("input", () => {
            const v = parseFloat(input.value);
            state[key] = v;
            valDisp.textContent = v;
            updateStateDisplay();
          });
          wrap.appendChild(input);
          wrap.appendChild(valDisp);
          state[key] = cfg.value;
        }

        if (cfg.type === "color") {
          input = document.createElement("input");
          input.type = "color";
          input.value = cfg.value;
          input.addEventListener("input", (e) => {
            state[key] = input.value;
            console.log("event", e.target.value);
            console.log("event2", input.value);
            updateStateDisplay();
          });
          wrap.appendChild(input);
          state[key] = cfg.value;
        }

        if (cfg.type === "select") {
          input = document.createElement("select");
          cfg.options.forEach((opt) => {
            const o = document.createElement("option");
            o.value = opt;
            o.textContent = opt;
            input.appendChild(o);
          });
          input.value = cfg.value;
          input.addEventListener("change", () => {
            state[key] = input.value;
            updateStateDisplay();
          });
          wrap.appendChild(input);
          state[key] = cfg.value;
        }
        if (cfg.type === "file") {
          input = document.createElement("input");
          input.type = "file";
          input.multiple = true;
          wrap.appendChild(input);
          state[key] = cfg.value;
        }
        controller.appendChild(wrap);
      }

      Object.entries(controls).forEach(([key, cfg]) => createControl(key, cfg));
      updateStateDisplay();

      // ==== DRAG FUNCTIONALITY USING TRANSFORM ====
      let startX,
        startY,
        initialX = 0,
        initialY = 0;
      let currentX = 0,
        currentY = 0;
      let isDragging = false;

      controller.addEventListener("mousedown", (e) => {
        if (e.target.tagName === "INPUT" || e.target.tagName === "SELECT")
          return;
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        controller.classList.add("dragging");
      });

      window.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        currentX = initialX + dx;
        currentY = initialY + dy;
        controller.style.transform = `translate(${currentX}px, ${currentY}px)`;
      });

      window.addEventListener("mouseup", () => {
        if (!isDragging) return;
        isDragging = false;
        initialX = currentX;
        initialY = currentY;
        controller.classList.remove("dragging");
        keepInViewport();
      });

      // Keep controller inside viewport on resize
      function keepInViewport() {
        const rect = controller.getBoundingClientRect();
        const vw = window.innerWidth;
        const vh = window.innerHeight;

        let newX = currentX;
        let newY = currentY;

        if (rect.left < 0) newX -= rect.left;
        if (rect.top < 0) newY -= rect.top;
        if (rect.right > vw) newX -= rect.right - vw;
        if (rect.bottom > vh) newY -= rect.bottom - vh;

        currentX = newX;
        currentY = newY;
        initialX = newX;
        initialY = newY;
        controller.style.transform = `translate(${newX}px, ${newY}px)`;
      }

      window.addEventListener("resize", keepInViewport);

    </script>
  </body>
</html>
